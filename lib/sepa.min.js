(function(exports){var t="http://www.w3.org/2001/XMLSchema-instance";var e="urn:iso:std:iso:20022:tech:xsd:pain.008.003.02 pain.008.003.02.xsd";var r="urn:iso:std:iso:20022:tech:xsd:pain.008.003.02";var n=".";function i(t){this.painFormat=t||"pain.008.003.02";this.grpHdr=new o;this._paymentInfo=[]}i.prototype={addPaymentInfo:function(t){if(t.id){t.id=this.grpHdr.id+n+t.id}else{t.id=this.grpHdr.id+n+this._paymentInfo.length}this._paymentInfo.push(t)},normalize:function(){var t=0;var e=0;for(var r=0;r<this._paymentInfo.length;r++){this._paymentInfo[r].normalize();t+=this._paymentInfo[r].controlSum;e+=this._paymentInfo[r].transactionCount}this.grpHdr.controlSum=t;this.grpHdr.transactionCount=e},toXML:function(){this.normalize();var n="urn:iso:std:iso:20022:tech:xsd:"+this.painFormat;var i=N(n,"Document");var o=i.documentElement;o.setAttributeNS(t,"xmlns",r);o.setAttributeNS(t,"xmlns:xsi",t);o.setAttributeNS(t,"xsi:schemaLocation",e);var s=i.createElementNS(n,"CstmrDrctDbtInitn");s.appendChild(this.grpHdr.toXML(i));for(var a=0;a<this._paymentInfo.length;a++){s.appendChild(this._paymentInfo[a].toXML(i))}i.documentElement.appendChild(s);return i},toString:function(){return A(this.toXML())}};function o(){}o.prototype={id:"",created:"",transactionCount:0,initiatorName:"",controlSum:0,toXML:function(t){var e=B(t,true,true);var r=t.createElementNS(t.documentElement.namespaceURI,"GrpHdr");e(r,"MsgId",this.id);e(r,"CreDtTm",this.created.toISOString());e(r,"NbOfTxs",this.transactionCount);e(r,"CtrlSum",this.controlSum.toFixed(2));e(r,"InitgPty","Nm",this.initiatorName);return r},toString:function(){return A(this.toXML())}};function s(){this._payments=[]}s.prototype={_payments:null,id:"",method:"DD",batchBooking:true,controlSum:0,localInstrumentation:"CORE",sequenceType:"FRST",collectionDate:null,creditorId:"",creditorName:"",creditorStreet:null,creditorCity:null,creditorCountry:null,creditorIBAN:"",creditorBIC:"",get transactionCount(){return this._payments.length},normalize:function(){var t=0;for(var e=0;e<this._payments.length;e++){t+=this._payments[e].amount}this.controlSum=t},addTransaction:function(t){if(t.id){t.id=this.id+n+t.id}else{t.id=this.id+n+this._payments.length}this._payments.push(t)},validate:function(){I(this.localInstrumentation,["CORE","COR1","B2B"],"localInstrumentation");I(this.sequenceType,["FRST","RCUR","OOFF","FNAL"],"sequenceType");b(this.collectionDate,"collectionDate");y(this.creditorId,"creditorId");p(this.creditorName,null,70,"creditorName");p(this.creditorStreet,null,70,"creditorStreet");p(this.creditorCity,null,70,"creditorCity");p(this.creditorCountry,null,2,"creditorCountry");v(this.creditorIBAN,"creditorIBAN");p(this.creditorBIC,[0,8,11],"creditorBIC");var t=this.creditorBIC.length==0||this.creditorBIC.substr(4,2)==this.creditorIBAN.substr(0,2);f(t,"country mismatch in BIC/IBAN");p(this._payments.length,1,null,"_payments")},toXML:function(t){this.validate();var e=B(t,true,false);var r=B(t,false,true);var n=B(t,true,true);var i=t.createElementNS(t.documentElement.namespaceURI,"PmtInf");n(i,"PmtInfId",this.id);n(i,"PmtMtd",this.method);n(i,"BtchBookg",this.batchBooking);n(i,"NbOfTxs",this.transactionCount);n(i,"CtrlSum",this.controlSum.toFixed(2));var o=e(i,"PmtTpInf");n(o,"SvcLvl","Cd","SEPA");n(o,"LclInstrm","Cd",this.localInstrumentation);n(o,"SeqTp",this.sequenceType);n(i,"ReqdColltnDt",this.collectionDate.toISOString().substr(0,10));var s=e(i,"Cdtr");n(s,"Nm",this.creditorName);if(this.creditorStreet&&this.creditorCity&&this.creditorCountry){var a=e(s,"PstlAdr");n(a,"Ctry",this.creditorCountry);n(a,"AdrLine",this.creditorStreet);n(a,"AdrLine",this.creditorCity)}n(i,"CdtrAcct","Id","IBAN",this.creditorIBAN);if(this.creditorBIC){n(i,"CdtrAgt","FinInstnId","BIC",this.creditorBIC)}else{n(i,"CdtrAgnt","FinInstnId","Othr","Id","NOTPROVIDED")}n(i,"ChrgBr","SLEV");var d=e(i,"CdtrSchmeId","Id","PrvtId","Othr");n(d,"Id",this.creditorId);n(d,"SchmeNm","Prtry","SEPA");for(var u=0;u<this._payments.length;u++){i.appendChild(this._payments[u].toXML(t))}return i},toString:function(){return A(this.toXML())}};function a(){}a.prototype={id:"",end2endId:"",currency:"EUR",amount:0,purposeCode:null,mandateId:"",mandateSignatureDate:null,debitorName:"",debitorStreet:null,debitorCity:null,debitorCountry:null,debitorIBAN:"",debitorBIC:"",remittanceInfo:"",validate:function(){g(this.end2endId,"end2endId");C(this.amount,.01,999999999.99,"amount");f(this.amount==this.amount.toFixed(2),"amount has too many fractional digits");p(this.purposeCode,1,4,"purposeCode");S(this.mandateId,"mandateId");b(this.mandateSignatureDate,"mandateSignatureDate");p(this.debitorName,null,70,"debitorName");p(this.debitorStreet,null,70,"debitorStreet");p(this.debitorCity,null,70,"debitorCity");p(this.debitorCountry,null,2,"debitorCountry");v(this.debitorIBAN,"debitorIBAN");I(this.debitorBIC.length,[0,8,11],"debitorBIC");var t=this.debitorBIC.length==0||this.debitorBIC.substr(4,2)==this.debitorIBAN.substr(0,2);f(t,"country mismatch in BIC/IBAN");p(this.remittanceInfo,null,140,"remittanceInfo")},toXML:function(t){this.validate();var e=B(t,true,false);var r=B(t,false,true);var n=B(t,true,true);var i=t.createElementNS(t.documentElement.namespaceURI,"DrctDbtTxInf");n(i,"PmtId","EndToEndId",this.end2endId);n(i,"InstdAmt",this.amount.toFixed(2)).setAttribute("Ccy",this.currency);var o=e(i,"DrctDbtTx","MndtRltdInf");n(o,"MndtId",this.mandateId);n(o,"DtOfSgntr",this.mandateSignatureDate.toISOString().substr(0,10));if(this.ammendment){}else{n(o,"AmdmntInd","false")}if(this.debitorBIC){n(i,"DbtrAgt","FinInstnId","BIC",this.debitorBIC)}else{n(i,"DbtrAgt","FinInstnId","Othr","Id","NOTPROVIDED")}var s=e(i,"Dbtr");n(s,"Nm",this.debitorName);if(this.debitorStreet&&this.debitorCity&&this.debitorCountry){var a=e(s,"PstlAdr");n(a,"Ctry",this.debitorCountry);n(a,"AdrLine",this.debitorStreet);n(a,"AdrLine",this.debitorCity)}n(i,"DbtrAcct","Id","IBAN",this.debitorIBAN);n(i,"RmtInf","Ustrd",this.remittanceInfo);r(i,"Purp","Cd",this.purposeCode);return i}};function d(t){var e="";for(var r=0;r<t.length;r++){var n=t.charCodeAt(r);if(n>=65&&n<=90){e+=(n-55).toString()}else if(n>=97&&n<=122){e+=(n-87).toString()}else if(n>=48&&n<=57){e+=t[r]}}return e}function u(t){var e=0;for(var r=0;r<t.length;r++){e=(e*10+parseInt(t[r],10))%97}return e}function c(t){var e=t.substr(4)+t.substr(0,4);return u(d(e))==1}function h(t){var e=t.substr(4)+t.substr(0,2)+"00";var r=u(d(e));return t.substr(0,2)+(98-r)+t.substr(4)}function m(t){var e=t.substr(7)+t.substr(0,4);return u(d(e))==1}function l(t){var e=t.substr(7)+t.substr(0,2)+"00";var r=u(d(e));return t.substr(0,2)+(98-r)+t.substr(4)}function f(t,e){if(!t){throw new Error(e)}}function I(t,e,r){if(e.indexOf(t)<0){throw new Error(r+" must have any value of: "+e.join(" ")+"(found: "+t+")")}}function p(t,e,r,n){if(e!==null&&t&&t.length<e||r!==null&&t&&t.length>r){throw new Error(n+" has invalid string length, expected "+e+" < "+t+" < "+r)}}function C(t,e,r,n){if(t<e||t>r){throw new Error(n+" does not match range "+e+" < "+t+" < "+r)}}function v(t,e){if(!c(t)){throw new Error(e+" has invalid IBAN '"+t+"'")}}function y(t,e){if(!m(t)){throw new Error(e+" has invalid creditor id '"+t+"'")}}function b(t,e){if(!t||isNaN(t.getTime())){throw new Error(e+" has invalid date "+t)}}function g(t,e){if(t&&!t.match(/([A-Za-z0-9]|[\+|\?|\/|\-|:|\(|\)|\.|,|'| ]){1,35}/)){throw new Error(e+" doesn't match sepa id charset type 1 (found: "+"'"+t+"')")}}function S(t,e){if(t&&!t.match(/([A-Za-z0-9]|[\+|\?|\/|\-|:|\(|\)|\.|,|']){1,35}/)){throw new Error(e+" doesn't match sepa id charset type 2 (found: "+"'"+t+"')")}}function N(t,e){if(typeof document!="undefined"&&typeof document.implementation!="undefined"){return document.implementation.createDocument(t,e)}else{var r=require("xmldom").DOMImplementation;return(new r).createDocument(t,e)}}function A(t){if(typeof window=="undefined"){var e=require("xmldom").XMLSerializer;var r=new e}else{var r=new window.XMLSerializer}return r.serializeToString(t)}function B(t,e,r){return function(){var n=arguments[0];var i=r&&arguments[arguments.length-1];var o=r?arguments.length-1:arguments.length;if(e||i||i===0){for(var s=1;s<o;s++){n=n.appendChild(t.createElementNS(t.documentElement.namespaceURI,arguments[s]))}if(r){n.textContent=i}return n}else{return null}}}exports.Document=i;exports.PaymentInfo=s;exports.Transaction=a;exports.validateIBAN=c;exports.checksumIBAN=h;exports.validateCreditorID=m;exports.checksumCreditorID=l})(typeof exports=="undefined"?this["SEPA"]={}:exports);