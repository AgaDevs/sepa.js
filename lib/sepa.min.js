(function(exports){var t="http://www.w3.org/2001/XMLSchema-instance";var e="urn:iso:std:iso:20022:tech:xsd:";var n=".";function r(t){n=t}var i=true;function o(t){i=!!t}var s={DirectDebit:"CstmrDrctDbtInitn",Transfer:"CstmrCdtTrfInitn"};function a(t,e){var n;if(t){n=typeof t==="string"?t:t.painFormat;e=typeof t==="string"?e:t.type}this._type=e||s.DirectDebit;this._paymentInfo=[];this.painFormat=n||(this._type===s.DirectDebit?"pain.008.003.02":"pain.001.001.03");this.grpHdr=new d}a.Types=s;a.prototype={painFormat:null,grpHdr:null,_paymentInfo:[],_type:null,addPaymentInfo:function(t){if(!(t instanceof h)){throw new Error("Given payment is not member of the PaymentInfo class")}if(t.id){t.id=this.grpHdr.id+n+t.id}else{t.id=this.grpHdr.id+n+this._paymentInfo.length}this._paymentInfo.push(t)},normalize:function(){var t=0;var e=0;for(var n=0,r=this._paymentInfo.length;n<r;++n){this._paymentInfo[n].normalize();t+=this._paymentInfo[n].controlSum;e+=this._paymentInfo[n].transactionCount}this.grpHdr.controlSum=t;this.grpHdr.transactionCount=e},toXML:function(){this.normalize();var n="urn:iso:std:iso:20022:tech:xsd:"+this.painFormat;var r=E(n,"Document");var i=r.documentElement;i.setAttributeNS(t,"xmlns",e+this.painFormat);i.setAttributeNS(t,"xmlns:xsi",t);i.setAttributeNS(t,"xsi:schemaLocation",e+this.painFormat+" "+this.painFormat+".xsd");var o=r.createElementNS(n,this._type);o.appendChild(this.grpHdr.toXML(r));for(var s=0,a=this._paymentInfo.length;s<a;++s){o.appendChild(this._paymentInfo[s].toXML(r))}r.documentElement.appendChild(o);return r},toString:function(){return w(this.toXML())}};function d(){}d.prototype={id:"",created:"",transactionCount:0,initiatorName:"",controlSum:0,toXML:function(t){var e=_(t,true,true);var n=t.createElementNS(t.documentElement.namespaceURI,"GrpHdr");e(n,"MsgId",this.id);e(n,"CreDtTm",this.created.toISOString());e(n,"NbOfTxs",this.transactionCount);e(n,"CtrlSum",this.controlSum.toFixed(2));e(n,"InitgPty","Nm",this.initiatorName);return n},toString:function(){return w(this.toXML())}};var u={DirectDebit:"DD",Transfer:"TRF"};function h(t){this.method=t||u.DirectDebit;this._payments=[]}h.PaymentInfoTypes=u;h.prototype={_payments:null,id:"",method:null,batchBooking:true,controlSum:0,localInstrumentation:"CORE",sequenceType:"FRST",collectionDate:null,requestedExecutionDate:null,creditorId:"",creditorName:"",creditorStreet:null,creditorCity:null,creditorCountry:null,creditorIBAN:"",creditorBIC:"",debtorId:"",debtorName:"",debtorStreet:null,debtorCity:null,debtorCountry:null,debtorIBAN:"",debtorBIC:"",instructionPriority:"NORM",get transactionCount(){return this._payments.length},normalize:function(){var t=0;for(var e=0,n=this._payments.length;e<n;++e){t+=this._payments[e].amount}this.controlSum=t},addTransaction:function(t){if(!(t instanceof m)){throw new Error("Given Transaction is not member of the SepaGenericTransaction class")}if(t.id){t.id=this.id+n+t.id}else{t.id=this.id+n+this._payments.length}this._payments.push(t)},validate:function(){var t=this.method===u.DirectDebit?"creditor":"debtor";v(this.localInstrumentation,["CORE","COR1","B2B"],"localInstrumentation");v(this.sequenceType,["FRST","RCUR","OOFF","FNAL"],"sequenceType");if(this.method===u.DirectDebit)A(this.collectionDate,"collectionDate");else A(this.requestedExecutionDate,"requestedExecutionDate");N(this[t+"Id"],t+"Id");D(this[t+"Name"],null,70,t+"Name");D(this[t+"Street"],null,70,t+"Street");D(this[t+"City"],null,70,t+"City");D(this[t+"Country"],null,2,t+"Country");S(this[t+"IBAN"],t+"IBAN");D(this[t+"BIC"],[0,8,11],t+"BIC");var e=this[t+"BIC"].length===0||this[t+"BIC"].substr(4,2)===this[t+"IBAN"].substr(0,2);b(e,"country mismatch in BIC/IBAN");D(this._payments.length,1,null,"_payments")},toXML:function(t){if(i)this.validate();var e=_(t,true,false);var n=_(t,true,true);var r=t.createElementNS(t.documentElement.namespaceURI,"PmtInf");n(r,"PmtInfId",this.id);n(r,"PmtMtd",this.method);n(r,"BtchBookg",this.method===u.DirectDebit?this.batchBooking:false);n(r,"NbOfTxs",this.transactionCount);n(r,"CtrlSum",this.controlSum.toFixed(2));var o=e(r,"PmtTpInf");n(o,"SvcLvl","Cd","SEPA");n(o,"LclInstrm","Cd",this.localInstrumentation);n(o,"SeqTp",this.sequenceType);if(this.method===u.DirectDebit)n(r,"ReqdColltnDt",this.collectionDate.toISOString().substr(0,10));else n(r,"ReqdExctnDt",this.requestedExecutionDate.toISOString().substr(0,10));var s=this.method===u.DirectDebit?"creditor":"debtor";var a=this.method===u.DirectDebit?"Cdtr":"Dbtr";var d=e(r,a);n(d,"Nm",this[s+"Name"]);if(this[s+"Street"]&&this[s+"City"]&&this[s+"Country"]){var h=e(d,"PstlAdr");n(h,"Ctry",this[s+"Country"]);n(h,"AdrLine",this[s+"Street"]);n(h,"AdrLine",this[s+"City"])}n(r,a+"Acct","Id","IBAN",this[s+"IBAN"]);if(this[s+"BIC"]){n(r,a+"Agt","FinInstnId","BIC",this[s+"BIC"])}else{n(r,a+"Agnt","FinInstnId","Othr","Id","NOTPROVIDED")}n(r,"ChrgBr","SLEV");var c=e(r,a+"SchmeId","Id","PrvtId","Othr");n(c,"Id",this[s+"Id"]);n(c,"SchmeNm","Prtry","SEPA");for(var m=0,l=this._payments.length;m<l;++m){r.appendChild(this._payments[m].toXML(t))}return r},toString:function(){return w(this.toXML())}};var c={DirectDebit:"DrctDbtTxInf",Transfer:"CdtTrfTxInf"};function m(t){this._type=t||c.DirectDebit}m.TransactionTypes=c;m.prototype={_type:c.DirectDebit,id:"",end2endId:"",currency:"EUR",amount:0,purposeCode:null,mandateId:"",mandateSignatureDate:null,debtorName:"",debtorStreet:null,debtorCity:null,debtorCountry:null,debtorIBAN:"",debtorBIC:"",remittanceInfo:"",creditorName:"",creditorStreet:null,creditorCity:null,creditorCountry:null,creditorIBAN:"",creditorBIC:"",validate:function(){var t=this._type===c.Transfer?"creditor":"debtor";B(this.end2endId,"end2endId");g(this.amount,.01,999999999.99,"amount");b(this.amount==this.amount.toFixed(2),"amount has too many fractional digits");D(this.purposeCode,1,4,"purposeCode");T(this.mandateId,"mandateId");A(this.mandateSignatureDate,"mandateSignatureDate");D(this[t+"Name"],null,70,t+"Name");D(this[t+"Street"],null,70,t+"Street");D(this[t+"City"],null,70,t+"City");D(this[t+"Country"],null,2,t+"Country");S(this[t+"IBAN"],t+"IBAN");v(this[t+"BIC"].length,[0,8,11],t+"BIC");var e=this[t+"BIC"].length===0||this[t+"BIC"].substr(4,2)===this[t+"IBAN"].substr(0,2);b(e,"country mismatch in BIC/IBAN");D(this.remittanceInfo,null,140,"remittanceInfo")},toXML:function(t){if(i)this.validate();var e=this._type===c.Transfer?"creditor":"debtor";var n=this._type===c.Transfer?"Cdtr":"Dbtr";var r=_(t,true,false);var o=_(t,false,true);var s=_(t,true,true);var a=t.createElementNS(t.documentElement.namespaceURI,this._type);s(a,"InstrId",this.id);s(a,"PmtId","EndToEndId",this.end2endId);if(this._type===c.DirectDebit){s(a,"InstdAmt",this.amount.toFixed(2)).setAttribute("Ccy",this.currency);var d=r(a,"DrctDbtTx","MndtRltdInf");s(d,"MndtId",this.mandateId);s(d,"DtOfSgntr",this.mandateSignatureDate.toISOString().substr(0,10));if(this.ammendment){s(d,"AmdmntInd","true");s(d,"AmdmnInfDtls",this.ammendment)}else{s(d,"AmdmntInd","false")}}else{s(a,"Amt","InstdAmt",this.amount.toFixed(2)).setAttribute("Ccy",this.currency)}if(this[e+"BIC"]){s(a,n+"Agt","FinInstnId","BIC",this[e+"BIC"])}else{s(a,n+"Agt","FinInstnId","Othr","Id","NOTPROVIDED")}var u=r(a,n);s(u,"Nm",this[e+"Name"]);if(this[e+"Street"]&&this[e+"City"]&&this[e+"Country"]){var h=r(u,"PstlAdr");s(h,"Ctry",this.debtorCountry);s(h,"AdrLine",this.debtorStreet);s(h,"AdrLine",this.debtorCity)}s(a,n+"Acct","Id","IBAN",this[e+"IBAN"]);s(a,"RmtInf","Ustrd",this.remittanceInfo);o(a,"Purp","Cd",this.purposeCode);return a}};function l(t){var e="";for(var n=0,r=t.length;n<r;++n){var i=t.charCodeAt(n);if(i>=65&&i<=90){e+=(i-55).toString()}else if(i>=97&&i<=122){e+=(i-87).toString()}else if(i>=48&&i<=57){e+=t[n]}}return e}function f(t){var e=0;for(var n=0,r=t.length;n<r;++n){e=(e*10+parseInt(t[n],10))%97}return e}function I(t){var e=t.substr(4)+t.substr(0,4);return f(l(e))===1}function p(t){var e=t.substr(4)+t.substr(0,2)+"00";var n=f(l(e));return t.substr(0,2)+("0"+(98-n)).substr(-2,2)+t.substr(4)}function y(t){var e=t.substr(7)+t.substr(0,4);return f(l(e))===1}function C(t){var e=t.substr(7)+t.substr(0,2)+"00";var n=f(l(e));return t.substr(0,2)+("0"+(98-n)).substr(-2,2)+t.substr(4)}function b(t,e){if(!t){throw new Error(e)}}function v(t,e,n){if(e.indexOf(t)<0){throw new Error(n+" must have any value of: "+e.join(" ")+"(found: "+t+")")}}function D(t,e,n,r){if(e!==null&&t&&t.length<e||n!==null&&t&&t.length>n){throw new Error(r+" has invalid string length, expected "+e+" < "+t+" < "+n)}}function g(t,e,n,r){if(t<e||t>n){throw new Error(r+" does not match range "+e+" < "+t+" < "+n)}}function S(t,e){if(!I(t)){throw new Error(e+' has invalid IBAN "'+t+'"')}}function N(t,e){if(!y(t)){throw new Error(e+' is invalid "'+t+'"')}}function A(t,e){if(!t||isNaN(t.getTime())){throw new Error(e+" has invalid date "+t)}}function B(t,e){if(t&&!t.match(/([A-Za-z0-9]|[\+|\?|\/|\-|:|\(|\)|\.|,|'| ]){1,35}/)){throw new Error(e+" doesn't match sepa id charset type 1 (found: "+'"'+t+'")')}}function T(t,e){if(t&&!t.match(/([A-Za-z0-9]|[\+|\?|\/|\-|:|\(|\)|\.|,|']){1,35}/)){throw new Error(e+" doesn't match sepa id charset type 2 (found: "+'"'+t+'")')}}function E(t,e){if(typeof document!=="undefined"&&typeof document.implementation!=="undefined"){return document.implementation.createDocument(t,e)}else{var n=require("xmldom").DOMImplementation;return(new n).createDocument(t,e)}}function w(t){var e;if(typeof window==="undefined"){var n=require("xmldom").XMLSerializer;e=new n}else{e=new window.XMLSerializer}return e.serializeToString(t)}function _(t,e,n){return function(){var r=arguments[0];var i=n&&arguments[arguments.length-1];var o=n?arguments.length-1:arguments.length;if(e||i||i===0){for(var s=1;s<o;++s){r=r.appendChild(t.createElementNS(t.documentElement.namespaceURI,arguments[s]))}if(n){r.textContent=i}return r}else{return null}}}exports.Document=a;exports.PaymentInfo=h;exports.Transaction=m;exports.DirectDebitTransaction=m.bind(undefined,c.DirectDebit);exports.TransferTransaction=m.bind(undefined,c.TransferTransaction);exports.GenericTransaction=m;exports.validateIBAN=I;exports.checksumIBAN=p;exports.validateCreditorID=y;exports.checksumCreditorID=C;exports.setIDSeparator=r;exports.enableValidations=o})(typeof exports==="undefined"?this.SEPA={}:exports);