(function(exports){var t="http://www.w3.org/2001/XMLSchema-instance";var e="urn:iso:std:iso:20022:tech:xsd:pain.008.003.02 pain.008.003.02.xsd";var r=".";function n(t){this.painFormat=t||"pain.008.003.02";this.grpHdr=new i;this._paymentInfo=[]}n.prototype={addPaymentInfo:function(t){if(t.id){t.id=this.grpHdr.id+r+t.id}else{t.id=this.grpHdr.id+r+this._paymentInfo.length}this._paymentInfo.push(t)},normalize:function(){var t=0;var e=0;for(var r=0;r<this._paymentInfo.length;r++){this._paymentInfo[r].normalize();t+=this._paymentInfo[r].controlSum;e+=this._paymentInfo[r].transactionCount}this.grpHdr.controlSum=t;this.grpHdr.transactionCount=e},toXML:function(){this.normalize();var r="urn:iso:std:iso:20022:tech:xsd:"+this.painFormat;var n=S(r,"Document");var i=n.documentElement;i.setAttributeNS(t,"schemaLocation",e);var o=n.createElementNS(r,"CstmrDrctDbtInitn");o.appendChild(this.grpHdr.toXML(n));for(var a=0;a<this._paymentInfo.length;a++){o.appendChild(this._paymentInfo[a].toXML(n))}n.documentElement.appendChild(o);return n},toString:function(){return N(this.toXML())}};function i(){}i.prototype={id:"",created:"",transactionCount:0,initiatorName:"",controlSum:0,toXML:function(t){var e=A(t,true,true);var r=t.createElementNS(t.documentElement.namespaceURI,"GrpHdr");e(r,"MsgId",this.id);e(r,"CreDtTm",this.created.toISOString());e(r,"NbOfTxs",this.transactionCount);e(r,"CtrlSum",this.controlSum.toFixed(2));e(r,"InitgPty","Nm",this.initiatorName);return r},toString:function(){return N(this.toXML())}};function o(){this._payments=[]}o.prototype={_payments:null,id:"",method:"DD",batchBooking:true,controlSum:0,localInstrumentation:"CORE",sequenceType:"FRST",collectionDate:null,creditorId:"",creditorName:"",creditorStreet:null,creditorCity:null,creditorCountry:null,creditorIBAN:"",creditorBIC:"",get transactionCount(){return this._payments.length},normalize:function(){var t=0;for(var e=0;e<this._payments.length;e++){t+=this._payments[e].amount}this.controlSum=t},addTransaction:function(t){if(t.id){t.id=this.id+r+t.id}else{t.id=this.id+r+this._payments.length}this._payments.push(t)},validate:function(){f(this.localInstrumentation,["CORE","COR1","B2B"],"localInstrumentation");f(this.sequenceType,["FRST","RCUR","OOFF","FNAL"],"sequenceType");y(this.collectionDate,"collectionDate");v(this.creditorId,"creditorId");I(this.creditorName,null,70,"creditorName");I(this.creditorStreet,null,70,"creditorStreet");I(this.creditorCity,null,70,"creditorCity");I(this.creditorCountry,null,2,"creditorCountry");C(this.creditorIBAN,"creditorIBAN");I(this.creditorBIC,[8,11],"creditorBIC");var t=this.creditorBIC.substr(4,2)==this.creditorIBAN.substr(0,2);l(t,"country mismatch in BIC/IBAN");I(this._payments.length,1,null,"_payments")},toXML:function(t){this.validate();var e=A(t,true,false);var r=A(t,false,true);var n=A(t,true,true);var i=t.createElementNS(t.documentElement.namespaceURI,"PmtInf");n(i,"PmtInfId",this.id);n(i,"PmtMtd",this.method);n(i,"BtchBookg",this.batchBooking);n(i,"NbOfTxs",this.transactionCount);n(i,"CtrlSum",this.controlSum.toFixed(2));var o=e(i,"PmtTpInf");n(o,"SvcLvl","Cd","SEPA");n(o,"LclInstrm","Cd",this.localInstrumentation);n(o,"SeqTp",this.sequenceType);n(i,"ReqdColltnDt",this.collectionDate.toISOString().substr(0,10));var a=e(i,"Cdtr");n(a,"Nm",this.creditorName);if(this.creditorStreet&&this.creditorCity&&this.creditorCountry){var s=e(a,"PstlAdr");n(s,"Ctry",this.creditorCountry);n(s,"AdrLine",this.creditorStreet);n(s,"AdrLine",this.creditorCity)}n(i,"CdtrAcct","Id","IBAN",this.creditorIBAN);n(i,"CdtrAgt","FinInstnId","BIC",this.creditorBIC);n(i,"ChrgBr","SLEV");var d=e(i,"CdtrSchmeId","Id","PrvtId","Othr");n(d,"Id",this.creditorId);n(d,"SchmeNm","Prtry","SEPA");for(var u=0;u<this._payments.length;u++){i.appendChild(this._payments[u].toXML(t))}return i},toString:function(){return N(this.toXML())}};function a(){}a.prototype={id:"",end2endId:"",currency:"EUR",amount:0,purposeCode:null,mandateId:"",mandateSignatureDate:null,debitorName:"",debitorStreet:null,debitorCity:null,debitorCountry:null,debitorIBAN:"",debitorBIC:"",remittanceInfo:"",validate:function(){b(this.end2endId,"end2endId");p(this.amount,.01,999999999.99,"amount");l(this.amount==this.amount.toFixed(2),"amount has too many fractional digits");I(this.purposeCode,1,4,"purposeCode");g(this.mandateId,"mandateId");y(this.mandateSignatureDate,"mandateSignatureDate");I(this.debitorName,null,70,"debitorName");I(this.debitorStreet,null,70,"debitorStreet");I(this.debitorCity,null,70,"debitorCity");I(this.debitorCountry,null,2,"debitorCountry");C(this.debitorIBAN,"debitorIBAN");f(this.debitorBIC.length,[8,11],"debitorBIC");var t=this.debitorBIC.substr(4,2)==this.debitorIBAN.substr(0,2);l(t,"country mismatch in BIC/IBAN");I(this.remittanceInfo,null,140,"remittanceInfo")},toXML:function(t){this.validate();var e=A(t,true,false);var r=A(t,false,true);var n=A(t,true,true);var i=t.createElementNS(t.documentElement.namespaceURI,"DrctDbtTxInf");n(i,"PmtId","EndToEndId",this.end2endId);n(i,"InstdAmt",this.amount.toFixed(2)).setAttribute("Ccy",this.currency);var o=e(i,"DrctDbtTx","MndtRltdInf");n(o,"MndtId",this.mandateId);n(o,"DtOfSgntr",this.mandateSignatureDate.toISOString().substr(0,10));if(this.ammendment){}else{n(o,"AmdmntInd","false")}n(i,"DbtrAgt","FinInstnId","BIC",this.debitorBIC);var a=e(i,"Dbtr");n(a,"Nm",this.debitorName);if(this.debitorStreet&&this.debitorCity&&this.debitorCountry){var s=e(a,"PstlAdr");n(s,"Ctry",this.debitorCountry);n(s,"AdrLine",this.debitorStreet);n(s,"AdrLine",this.debitorCity)}n(i,"DbtrAcct","Id","IBAN",this.debitorIBAN);n(i,"RmtInf","Ustrd",this.remittanceInfo);r(i,"Purp","Cd",this.purposeCode);return i}};function s(t){var e="";for(var r=0;r<t.length;r++){var n=t.charCodeAt(r);if(n>=65&&n<=90){e+=(n-55).toString()}else if(n>=97&&n<=122){e+=(n-87).toString()}else if(n>=48&&n<=57){e+=t[r]}}return e}function d(t){var e=0;for(var r=0;r<t.length;r++){e=(e*10+parseInt(t[r],10))%97}return e}function u(t){var e=t.substr(4)+t.substr(0,4);return d(s(e))==1}function c(t){var e=t.substr(4)+t.substr(0,2)+"00";var r=d(s(e));return t.substr(0,2)+(98-r)+t.substr(4)}function h(t){var e=t.substr(7)+t.substr(0,4);return d(s(e))==1}function m(t){var e=t.substr(7)+t.substr(0,2)+"00";var r=d(s(e));return t.substr(0,2)+(98-r)+t.substr(4)}function l(t,e){if(!t){throw new Error(e)}}function f(t,e,r){if(e.indexOf(t)<0){throw new Error(r+" must have a specific value: "+t+"(found: "+str+")")}}function I(t,e,r,n){if(e!==null&&t&&t.length<e||r!==null&&t&&t.length>r){throw new Error(n+" has invalid string length, expected "+e+" < "+t+" < "+r)}}function p(t,e,r,n){if(t<e||t>r){throw new Error(n+" does not match range "+e+" < "+t+" < "+r)}}function C(t,e){if(!u(t)){throw new Error(e+" has invalid IBAN '"+t+"'")}}function v(t,e){if(!h(t)){throw new Error(e+" has invalid creditor id '"+t+"'")}}function y(t,e){if(!t||isNaN(t.getTime())){throw new Error(e+" has invalid date "+t)}}function b(t,e){if(t&&!t.match(/([A-Za-z0-9]|[\+|\?|\/|\-|:|\(|\)|\.|,|'| ]){1,35}/)){throw new Error(e+" doesn't match sepa id charset type 1 (found: "+"'"+t+"')")}}function g(t,e){if(t&&!t.match(/([A-Za-z0-9]|[\+|\?|\/|\-|:|\(|\)|\.|,|']){1,35}/)){throw new Error(e+" doesn't match sepa id charset type 2 (found: "+"'"+t+"')")}}function S(t,e){if(typeof document!="undefined"&&typeof document.implementation!="undefined"){return document.implementation.createDocument(t,e)}else{var r=require("xmldom").DOMImplementation;return(new r).createDocument(t,e)}}function N(t){if(typeof window=="undefined"){var e=require("xmldom").XMLSerializer;var r=new e}else{var r=new window.XMLSerializer}return r.serializeToString(t)}function A(t,e,r){return function(){var n=arguments[0];var i=r&&arguments[arguments.length-1];var o=r?arguments.length-1:arguments.length;if(e||i||i===0){for(var a=1;a<o;a++){n=n.appendChild(t.createElementNS(t.documentElement.namespaceURI,arguments[a]))}if(r){n.textContent=i}return n}else{return null}}}exports.Document=n;exports.PaymentInfo=o;exports.Transaction=a;exports.validateIBAN=u;exports.checksumIBAN=c;exports.validateCreditorID=h;exports.checksumCreditorID=m})(typeof exports=="undefined"?this["SEPA"]={}:exports);